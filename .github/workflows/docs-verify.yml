name: Documentation Verification

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - 'README.md'
      - 'CLAUDE.md'
      - 'src/elspais/**'
      - 'tests/test_doc_sync.py'
  pull_request:
    paths:
      - 'docs/**'
      - 'README.md'
      - 'CLAUDE.md'
      - 'src/elspais/**'
      - 'tests/test_doc_sync.py'

jobs:
  verify-docs:
    name: Verify Documentation Sync
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[dev]"

      - name: Run documentation sync tests
        run: |
          pytest tests/test_doc_sync.py -v --tb=short

      - name: Check for deprecated config options
        run: |
          echo "Checking for deprecated require_acceptance usage..."
          if grep -r "require_acceptance" src/ docs/ --include="*.py" --include="*.md" --include="*.toml" | grep -v "deprecated\|legacy\|test_doc"; then
            echo "::error::Found deprecated 'require_acceptance' in production code/docs"
            exit 1
          fi
          echo "No deprecated options found"

      - name: Verify CLI help matches docs
        run: |
          echo "Verifying CLI commands are documented..."
          python -m elspais --help
          echo "CLI help verification passed"

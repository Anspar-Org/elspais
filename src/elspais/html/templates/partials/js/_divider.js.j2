// Partial: _divider.js.j2 â€” Resizable panel dividers

{% if mode == 'edit' %}

function initDividers() {
    initDivider('divider-left', 'nav-panel', 'left');
    initDivider('divider-right', 'file-viewer-panel', 'right');
}

function initDivider(dividerId, panelId, side) {
    const divider = document.getElementById(dividerId);
    const panel = document.getElementById(panelId);
    const layout = document.getElementById('layout');
    let isDragging = false;

    divider.addEventListener('mousedown', function(e) {
        isDragging = true;
        divider.classList.add('dragging');
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
    });

    document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        const layoutRect = layout.getBoundingClientRect();
        if (side === 'left') {
            const width = Math.max(150, Math.min(500, e.clientX - layoutRect.left));
            panel.style.width = width + 'px';
        } else {
            const width = Math.max(250, Math.min(layoutRect.width * 0.6, layoutRect.right - e.clientX));
            panel.style.width = width + 'px';
        }
    });

    document.addEventListener('mouseup', function() {
        if (!isDragging) return;
        isDragging = false;
        divider.classList.remove('dragging');
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        saveState();
    });
}

{% else %}

(function() {
    const divider = document.getElementById('split-divider');
    const layout = document.getElementById('split-layout');
    const panel = document.getElementById('file-viewer-panel');
    let isDragging = false;

    divider.addEventListener('mousedown', function(e) {
        isDragging = true;
        divider.classList.add('dragging');
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
    });

    document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        const layoutRect = layout.getBoundingClientRect();
        const totalWidth = layoutRect.width;
        const mouseX = e.clientX - layoutRect.left;
        // Calculate panel width as percentage (panel is on the right)
        const panelPct = Math.max(15, Math.min(75, ((totalWidth - mouseX) / totalWidth) * 100));
        panel.style.width = panelPct + '%';
        state.splitRatio = panelPct;
    });

    document.addEventListener('mouseup', function() {
        if (!isDragging) return;
        isDragging = false;
        divider.classList.remove('dragging');
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        saveStateToCookie();
    });
})();

{% endif %}

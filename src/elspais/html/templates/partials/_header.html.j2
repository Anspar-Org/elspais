{# Partial: _header.html.j2 â€” Mode-conditional header #}
{# Edit: 3-column layout with search + edit controls #}
{# View: flat layout with stat badges, assertion summary, legend/reset #}

{% if mode == 'edit' %}

<header class="header">
    <div class="header-left">
        <h1 class="header-title">Trace Edit</h1>
        <div class="header-stats" id="header-stats">
            <span class="stat-badge prd" id="stat-prd">PRD: --</span>
            <span class="stat-badge ops" id="stat-ops">OPS: --</span>
            <span class="stat-badge dev" id="stat-dev">DEV: --</span>
        </div>
    </div>

    <div class="header-center">
        <div class="search-box" id="search-box">
            <input type="text" id="search-input" placeholder="Search requirements..." autocomplete="off">
            <div class="search-results" id="search-results"></div>
        </div>
    </div>

    <div class="header-right">
        <button class="edit-toggle" id="edit-toggle" onclick="toggleEditMode()" title="Toggle edit mode">
            <span class="edit-toggle-indicator"></span>
            <span>Edit Mode</span>
        </button>

        <button class="btn" id="btn-undo" onclick="doUndo()" disabled title="Undo last change">
            Undo
        </button>

        <button class="btn btn-primary" id="btn-save" onclick="doSave()" disabled title="Save mutations to disk">
            Save
            <span class="unsaved-badge hidden" id="unsaved-badge">0</span>
        </button>

        <button class="btn btn-danger" id="btn-revert" onclick="doRevert()" disabled title="Revert all unsaved changes">
            Revert
        </button>
    </div>
</header>

{% else %}

<header class="header">
    <h1 class="header-title">Requirements Traceability</h1>

    <div class="header-stats">
        <span class="stat-badge prd" id="badge-prd" onclick="toggleLevelFilter('PRD')" title="Click to filter PRD only">PRD: {{ stats.prd_count }}</span>
        <span class="stat-badge ops" id="badge-ops" onclick="toggleLevelFilter('OPS')" title="Click to filter OPS only">OPS: {{ stats.ops_count }}</span>
        <span class="stat-badge dev" id="badge-dev" onclick="toggleLevelFilter('DEV')" title="Click to filter DEV only">DEV: {{ stats.dev_count }}</span>
        <span style="color: #adb5bd;">|</span>
        <span class="stat-badge core" id="badge-core" onclick="toggleFilter('core')" title="Click to hide core (non-associated) requirements">Core: {{ stats.total_count - stats.associated_count }}</span>
        <span style="color: #adb5bd;">|</span>
        <span class="stat-badge code" id="badge-code" onclick="toggleFilter('code')" title="Click to hide code nodes">Code: {{ stats.code_count }}</span>
        <span class="stat-badge tests" id="badge-tests" onclick="toggleFilter('tests')" title="Click to hide test nodes">Tests: {{ stats.test_count }}</span>
        {% if stats.test_result_count > 0 %}
        <span class="stat-badge results" id="badge-results" onclick="toggleFilter('results')" title="Click to show test results">Results: {{ stats.test_passed_count }}âœ“ {{ stats.test_failed_count }}âœ—</span>
        {% endif %}
        <span class="stat-badge associated" id="badge-associated" onclick="toggleFilter('associated')" title="Click to filter associated repos">Assoc: {{ stats.associated_count|default(0) }}</span>
    </div>

    <div class="assertion-summary">
        Assertions: <strong>{{ stats.assertion_count }}</strong> unique |
        Implemented: <strong>{{ stats.assertions_implemented }}</strong> |
        Tested: <strong>{{ stats.assertions_tested }}</strong> |
        Validated: <strong>{{ stats.assertions_validated }}</strong>
    </div>

    <div class="header-meta">
        <span class="version-badge">v{{ version }}</span>
        <button class="legend-btn" onclick="toggleLegend()">
            <span>â„¹</span> Legend
        </button>
        <button class="legend-btn" onclick="clearAllCookies()" title="Clear saved preferences">
            <span>ğŸª</span> Reset
        </button>
    </div>
</header>

{% endif %}
